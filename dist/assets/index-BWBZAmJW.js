(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(i){if(i.ep)return;i.ep=!0;const a=t(i);fetch(i.href,a)}})();const d=[{id:1,title:"Fase 1: A Triagem",description:"Paciente J.S., 25 anos, sexo feminino. Relata cansaço excessivo e falta de ar ao subir escadas. Identifique os sintomas que indicam possível anemia.",type:"selection",options:[{id:"s1",text:"Palidez cutâneo-mucosa",correct:!0},{id:"s2",text:"Bradicardia (coração lento)",correct:!1},{id:"s3",text:"Taquicardia (coração rápido)",correct:!0},{id:"s4",text:"Hipertensão",correct:!1},{id:"s5",text:"Fadiga / Astenia",correct:!0},{id:"s6",text:"Ganho de peso repentino",correct:!1}],minCorrect:3,maxMistakes:1,successMessage:"Sintomas identificados corretamente! O quadro clínico sugere anemia. Vamos investigar o sangue.",failMessage:"Diagnóstico incorreto. Revise os sinais clínicos de anemia."},{id:2,title:"Fase 2: O Laboratório",description:"Analise o Hemograma da paciente. Quais valores estão ALTERADOS indicando Anemia Ferropriva?",type:"analysis",data:{hemoglobina:"9.0 g/dL (Ref: 12-16)",hematocrito:"28% (Ref: 36-46)",vcm:"70 fL (Ref: 80-100)",ferritina:"10 ng/mL (Ref: 15-150)"},options:[{id:"a1",text:"Hemoglobina Baixa",correct:!0},{id:"a2",text:"Hematócrito Alto",correct:!1},{id:"a3",text:"VCM Baixo (Microcitose)",correct:!0},{id:"a4",text:"Ferritina Normal",correct:!1}],minCorrect:3,maxMistakes:1,successMessage:"Análise precisa! Anemia Microcítica e Hipocrômica confirmada. Causa provável: Deficiência de Ferro.",failMessage:"Interpretação incorreta dos exames."},{id:3,title:"Fase 3: A Despensa",description:"Monte uma refeição rica em Ferro para o tratamento. Selecione os alimentos corretos e evite inibidores.",type:"drag-drop",options:[{id:"f1",text:"Fígado Bovino",type:"food",correct:!0},{id:"f2",text:"Feijão Preto",type:"food",correct:!0},{id:"f3",text:"Suco de Laranja (Vitamina C)",type:"enhancer",correct:!0},{id:"f4",text:"Café / Chá Preto",type:"inhibitor",correct:!1},{id:"f5",text:"Leite (Cálcio)",type:"inhibitor",correct:!1},{id:"f6",text:"Couve Escura",type:"food",correct:!0}],minCorrect:4,maxMistakes:1,successMessage:"Refeição perfeita! A combinação de Ferro Heme, Não-Heme e Vitamina C otimiza a absorção.",failMessage:"Cuidado! Você escolheu alimentos com pouco ferro ou misturou com inibidores de absorção."},{id:4,title:"Fase 4: A Prescrição",description:"Qual a recomendação final para a paciente?",type:"quiz",options:[{id:"p1",text:"Apenas dieta é suficiente para repor estoques zerados.",correct:!1},{id:"p2",text:"Suplementação de Sulfato Ferroso + Dieta rica em ferro + Retorno em 3 meses.",correct:!0},{id:"p3",text:"Transfusão de sangue imediata.",correct:!1}],minCorrect:1,maxMistakes:0,successMessage:"Conduta correta! A paciente está no caminho da recuperação.",failMessage:"Conduta inadequada para o grau da anemia."}];class f{constructor(e,t){this.canvas=document.getElementById(e),this.ctx=this.canvas.getContext("2d"),this.onObstacleEncountered=t,this.width=window.innerWidth,this.height=window.innerHeight,this.canvas.width=this.width,this.canvas.height=this.height,this.ship={x:100,y:this.height/2,size:30,speed:5},this.asteroids=[],this.stars=[],this.lasers=[],this.particles=[],this.gameActive=!1,this.isPaused=!1,this.lastTime=0,this.spawnTimer=0,this.obstaclePending=!1,this.initStars(),window.addEventListener("resize",()=>this.resize())}resize(){this.width=window.innerWidth,this.height=window.innerHeight,this.canvas.width=this.width,this.canvas.height=this.height,this.initStars()}initStars(){this.stars=[];for(let e=0;e<100;e++)this.stars.push({x:Math.random()*this.width,y:Math.random()*this.height,size:Math.random()*2,speed:Math.random()*3+.5})}start(){this.gameActive=!0,this.isPaused=!1,this.obstaclePending=!1,this.asteroids=[],this.lasers=[],this.particles=[],this.lastTime=performance.now(),this.loop(this.lastTime)}spawnObstacle(){this.obstaclePending||(this.asteroids.push({x:this.width+50,y:this.height/2,size:60,hp:1,active:!0}),this.obstaclePending=!0)}shoot(){this.lasers.push({x:this.ship.x+this.ship.size,y:this.ship.y,speed:15,active:!0}),this.createExplosion(this.ship.x+this.ship.size,this.ship.y,"#00ffff",5)}crash(){this.createExplosion(this.ship.x,this.ship.y,"#ff0000",20)}createExplosion(e,t,s,i){for(let a=0;a<i;a++)this.particles.push({x:e,y:t,vx:(Math.random()-.5)*10,vy:(Math.random()-.5)*10,life:1,color:s})}update(e){this.isPaused||(this.stars.forEach(t=>{t.x-=t.speed,t.x<0&&(t.x=this.width)}),this.asteroids.forEach(t=>{t.active&&(t.x-=2,t.x<this.width-300&&this.obstaclePending&&(this.isPaused=!0,this.onObstacleEncountered()))}),this.lasers.forEach(t=>{t.x+=t.speed,t.x>this.width&&(t.active=!1),this.asteroids.forEach(s=>{if(s.active&&t.active){const i=t.x-s.x,a=t.y-s.y;Math.sqrt(i*i+a*a)<s.size&&(s.active=!1,t.active=!1,this.createExplosion(s.x,s.y,"#ffaa00",15),this.obstaclePending=!1,this.isPaused=!1)}})}),this.particles.forEach(t=>{t.x+=t.vx,t.y+=t.vy,t.life-=.05}),this.particles=this.particles.filter(t=>t.life>0))}draw(){this.ctx.fillStyle="#000000",this.ctx.fillRect(0,0,this.width,this.height),this.ctx.fillStyle="#ffffff",this.stars.forEach(e=>{this.ctx.beginPath(),this.ctx.arc(e.x,e.y,e.size,0,Math.PI*2),this.ctx.fill()}),this.ctx.save(),this.ctx.translate(this.ship.x,this.ship.y),this.ctx.fillStyle="#00ff00",this.ctx.beginPath(),this.ctx.moveTo(20,0),this.ctx.lineTo(-15,10),this.ctx.lineTo(-15,-10),this.ctx.fill(),this.ctx.fillStyle=`rgba(0, 255, 255, ${Math.random()})`,this.ctx.beginPath(),this.ctx.moveTo(-15,0),this.ctx.lineTo(-30,5),this.ctx.lineTo(-30,-5),this.ctx.fill(),this.ctx.restore(),this.asteroids.forEach(e=>{e.active&&(this.ctx.fillStyle="#888888",this.ctx.beginPath(),this.ctx.arc(e.x,e.y,e.size,0,Math.PI*2),this.ctx.fill(),this.ctx.fillStyle="#666666",this.ctx.beginPath(),this.ctx.arc(e.x-10,e.y-10,e.size/3,0,Math.PI*2),this.ctx.fill())}),this.ctx.fillStyle="#00ffff",this.lasers.forEach(e=>{e.active&&this.ctx.fillRect(e.x,e.y-2,20,4)}),this.particles.forEach(e=>{this.ctx.fillStyle=e.color,this.ctx.globalAlpha=e.life,this.ctx.beginPath(),this.ctx.arc(e.x,e.y,3,0,Math.PI*2),this.ctx.fill(),this.ctx.globalAlpha=1})}loop(e){if(!this.gameActive)return;const t=e-this.lastTime;this.lastTime=e,this.update(t),this.draw(),requestAnimationFrame(s=>this.loop(s))}resume(){this.isPaused=!1,this.lastTime=performance.now()}}class m{constructor(){this.currentLevelIndex=0,this.score=0,this.mistakes=0,this.gameActive=!1,this.ui={app:document.getElementById("app"),container:document.getElementById("game-container"),loading:document.getElementById("loading-screen"),hud:document.getElementById("hud"),questionPanel:document.getElementById("question-panel")},this.arcade=null}init(){setTimeout(()=>{this.ui.loading.classList.add("hidden"),this.startGame()},1500)}startGame(){this.currentLevelIndex=0,this.score=0,this.mistakes=0,this.gameActive=!0,this.ui.container.innerHTML=`
      <canvas id="game-canvas"></canvas>
      <div id="hud" class="hud">
        <div class="score">SCORE: <span id="score-val">0</span></div>
        <div class="health">INTEGRITY: <span id="health-val">100%</span></div>
      </div>
      <div id="question-panel" class="question-panel hidden">
        <!-- Question injected here -->
      </div>
    `,this.arcade=new f("game-canvas",()=>this.showQuestion()),this.arcade.start(),setTimeout(()=>this.arcade.spawnObstacle(),2e3)}showQuestion(){const e=d[this.currentLevelIndex];if(!e){this.showEndScreen(!0);return}const t=document.getElementById("question-panel");t.innerHTML=`
      <div class="panel-content">
        <h2>ALERTA DE COLISÃO!</h2>
        <p class="description">${e.description}</p>
        ${this.renderLevelData(e)}
        <div class="options-grid">
          ${e.options.map(s=>`
            <button class="option-btn" data-id="${s.id}">${s.text}</button>
          `).join("")}
        </div>
        <div id="feedback-area" class="hidden"></div>
      </div>
    `,t.classList.remove("hidden"),this.attachEvents(e)}renderLevelData(e){return e.type==="analysis"&&e.data?`
        <div class="data-panel">
          <ul>
            ${Object.entries(e.data).map(([t,s])=>`<li><strong>${t.toUpperCase()}:</strong> ${s}</li>`).join("")}
          </ul>
        </div>
      `:""}attachEvents(e){const t=document.getElementById("question-panel"),s=t.querySelectorAll(".option-btn"),i=t.querySelector("#feedback-area");let a=0,o=0;const c=new Set;s.forEach(n=>{n.addEventListener("click",()=>{if(c.has(n.dataset.id))return;const h=n.dataset.id,l=e.options.find(u=>u.id===h);c.add(h),l.correct?(n.classList.add("correct"),a++):(n.classList.add("wrong"),o++,this.mistakes++,this.updateHealth()),o>e.maxMistakes?this.handleFail(i,e.failMessage):a>=e.minCorrect&&this.handleSuccess(i,e.successMessage)})})}handleSuccess(e,t){e.textContent=t,e.className="feedback success",e.classList.remove("hidden"),setTimeout(()=>{document.getElementById("question-panel").classList.add("hidden"),this.arcade.shoot(),this.score+=100,this.updateScore(),this.nextLevel()},1500)}handleFail(e,t){e.textContent=t,e.className="feedback fail",e.classList.remove("hidden"),setTimeout(()=>{document.getElementById("question-panel").classList.add("hidden"),this.arcade.crash(),this.updateHealth(),this.nextLevel()},1500)}nextLevel(){this.currentLevelIndex++,this.currentLevelIndex>=d.length?setTimeout(()=>this.showEndScreen(!0),2e3):setTimeout(()=>this.arcade.spawnObstacle(),3e3)}updateScore(){document.getElementById("score-val").textContent=this.score}updateHealth(){const e=Math.max(0,100-this.mistakes*25);document.getElementById("health-val").textContent=`${e}%`,e<=0&&this.showEndScreen(!1)}disableAllButtons(){document.querySelectorAll(".option-btn").forEach(t=>t.disabled=!0)}showEndScreen(e){this.ui.container.innerHTML=`
      <div class="end-screen">
        <h1>${e?"MISSÃO CUMPRIDA!":"FALHA NO PROTOCOLO"}</h1>
        <p>${e?"Você salvou a paciente e demonstrou excelente conhecimento em nutrição clínica.":"A paciente não recebeu o tratamento adequado a tempo."}</p>
        <button id="restart-btn" class="btn">Reiniciar Protocolo</button>
      </div>
    `,document.getElementById("restart-btn").addEventListener("click",()=>{this.startGame()})}}const p=new m;p.init();
